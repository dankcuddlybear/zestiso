#!/bin/sh
MoveRCFile() {
	if [ -f $1 ]; then
		echo "# DO NOT EDIT THIS FILE - IT WILL BE OVERWRITTEN AFTER UPGRADING BASH" > $2
		echo "# This is the default bashrc on Arch Linux. It is meant to be left as-is." >> $2
		echo "# You can create one or more custom Bash configs inside /etc/bashrc.d" >> $2
		echo "# You can also disable this config (not recommended) by creating an empty file at /etc/bashrc.d/00-no-default-bashrc" >> $2
		echo "[ -f /etc/bashrc.d/00-no-default-bashrc ] && return" >> $2
		cat $1 >> $2
		rm $1
	fi
}
CreateDefaultBashRC() {
	echo "# DO NOT EDIT THIS FILE - IT WILL BE OVERWRITTEN AFTER UPGRADING BASHRC-D" > /etc/bash.bashrc
	echo "# This bashrc file loads bash configs from /etc/bashrc.d. It is not meant to be edited." >> /etc/bash.bashrc
	echo "# You can create one or more custom Bash configs inside /etc/bashrc.d" >> /etc/bash.bashrc
	echo "if [[ -r /etc/bashrc.d ]]; then for FILE in \$(ls /etc/bashrc.d); do . /etc/bashrc.d/\$FILE; done; fi" >> /etc/bash.bashrc
}
case $1 in
	install)
		mkdir -p /etc/bashrc.d
		MoveRCFile /etc/bash.bashrc /etc/bashrc.d/00-bash.bashrc
		CreateDefaultBashRC;;
	upgrade)
		mkdir -p /etc/bashrc.d
		MoveRCFile /etc/bash.bashrc.pacnew /etc/bashrc.d/00-bash.bashrc
		CreateDefaultBashRC;;
	uninstall)
		mv /etc/bashrc.d/00-bash.bashrc /etc/bash.bashrc
		sed -i "/# DO NOT EDIT THIS FILE - IT WILL BE OVERWRITTEN AFTER UPGRADING BASH/d" /etc/bash.bashrc
		sed -i "/# This is the default bashrc on Arch Linux. It is meant to be left as-is./d" /etc/bash.bashrc
		sed -i "/# You can create one or more custom Bash configs inside/d" /etc/bash.bashrc
		sed -i "/You can also disable this config (not recommended) by creating an empty file at/d" /etc/bash.bashrc
		sed -i "/00-no-default-bashrc/d" /etc/bash.bashrc
		rm /etc/bash.bashrc.pacnew /etc/bash.bashrc.pacsave &> /dev/null
		rmdir /etc/bashrc.d &> /dev/null;;
esac
